<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>GPS Sender</title>

<style>
body {
  background:#111;
  color:#eee;
  font-family:Arial;
  text-align:center;
  padding:15px;
}
input, button {
  font-size:16px;
  padding:8px;
  margin:6px;
}
#pair {
  font-weight:bold;
  letter-spacing:2px;
}
#sos {
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  background:red;
  color:white;
  font-size:20px;
  font-weight:bold;
  border:none;
  border-radius:50px;
  padding:14px 28px;
}
</style>
</head>

<body>

<h2>üìç GPS Sender</h2>

<div>
  Pair Code:
  <input id="pair" readonly>
</div>

<button onclick="startSharing()">Start Sharing</button>
<button onclick="stopSharing()">Stop</button>

<p id="status">Idle</p>

<button id="sos" onclick="sendSOS()">üö® SOS</button>

<script>
const ws = new WebSocket("wss://ws-relay-zqzk.onrender.com");
let watchId = null;

// generate secure-ish pair code
function generatePair() {
  return Math.random().toString(36).substring(2,8).toUpperCase();
}
const pairCode = generatePair();
document.getElementById("pair").value = pairCode;

ws.onopen = () => console.log("WebSocket connected");

// GPS
function startSharing() {
  if (!navigator.geolocation) {
    alert("GPS not supported");
    return;
  }

  watchId = navigator.geolocation.watchPosition(
    pos => {
      ws.send(JSON.stringify({
        type: "gps",
        pair: pairCode,
        lat: pos.coords.latitude,
        lon: pos.coords.longitude,
        acc: pos.coords.accuracy,
        ts: Date.now()
      }));
      document.getElementById("status").innerText = "Sharing location‚Ä¶";
    },
    err => alert("GPS error"),
    { enableHighAccuracy:true, maximumAge:0 }
  );
}

function stopSharing() {
  if (watchId) navigator.geolocation.clearWatch(watchId);
  document.getElementById("status").innerText = "Stopped";
}

// SOS
function sendSOS() {
  ws.send(JSON.stringify({
    type: "sos",
    pair: pairCode,
    ts: Date.now()
  }));
  alert("üö® SOS sent!");
}
</script>

</body>
</html>
