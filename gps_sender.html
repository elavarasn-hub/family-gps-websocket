<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>GPS Sender</title>

<style>
body {
  background:#111;
  color:#eee;
  font-family:Arial;
  text-align:center;
  padding:20px;
}
input,button {
  padding:10px;
  font-size:16px;
  margin:8px;
}
</style>
</head>

<body>

<h2>üìç GPS SENDER</h2>

Pair Code:<br>
<input id="pair" placeholder="Enter pair code"><br>

<button onclick="start()">Start GPS</button>

<p id="status">Idle</p>

<script>
const ws = new WebSocket("wss://ws-relay-zqzk.onrender.com");
let watchId = null;

ws.onopen = () => console.log("WS connected");

function start() {
  const pair = document.getElementById("pair").value.trim();
  if (!pair) {
    alert("Enter pair code");
    return;
  }

  if (!navigator.geolocation) {
    alert("GPS not supported");
    return;
  }

  document.getElementById("status").innerText = "Getting GPS‚Ä¶";

  watchId = navigator.geolocation.watchPosition(
    pos => {
      const data = {
        pair: pair,
        lat: pos.coords.latitude,
        lon: pos.coords.longitude,
        acc: pos.coords.accuracy,
        ts: Date.now()
      };

      if (ws.readyState === WebSocket.OPEN) {
        ws.send(JSON.stringify(data));
        document.getElementById("status").innerText =
          "GPS sent (accuracy " + Math.round(pos.coords.accuracy) + " m)";
      }
    },
    err => {
      alert("GPS ERROR: " + err.message);
    },
    {
      enableHighAccuracy: true,   // üî¥ CRITICAL
      maximumAge: 0,
      timeout: 15000
    }
  );
}
</script>

</body>
</html>
