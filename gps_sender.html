<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>GPS Sender</title>

<style>
body {
  background:#111;
  color:#eee;
  font-family:Arial;
  text-align:center;
  padding:20px;
}
input, button {
  font-size:16px;
  padding:8px;
  margin:6px;
}
#status { margin-top:10px; }
</style>
</head>

<body>

<h2>üìç GPS Sender</h2>

Pair Code:<br>
<input id="code" value="AB1234"><br>

<button onclick="start()">Start Sharing</button>
<button onclick="stop()">Stop</button>

<div id="status">Idle</div>

<script>
const ws = new WebSocket("wss://ws-relay-zqzk.onrender.com");
let watchId = null;

ws.onopen = () => {
  console.log("WebSocket connected");
};

function start() {
  if (!navigator.geolocation) {
    alert("GPS not supported");
    return;
  }

  const pair = document.getElementById("code").value.trim();
  if (!pair) return alert("Enter pair code");

  document.getElementById("status").innerText = "Sharing location...";

  watchId = navigator.geolocation.watchPosition(pos => {
    const msg = {
      type: "gps",
      pair: pair,
      lat: pos.coords.latitude,
      lon: pos.coords.longitude,
      ts: Date.now()
    };

    if (ws.readyState === WebSocket.OPEN) {
      ws.send(JSON.stringify(msg));
    }
  }, err => {
    alert("GPS error: " + err.message);
  }, {
    enableHighAccuracy: true,
    maximumAge: 2000,
    timeout: 10000
  });
}

function stop() {
  if (watchId !== null) {
    navigator.geolocation.clearWatch(watchId);
    watchId = null;
  }
  document.getElementById("status").innerText = "Stopped";
}
</script>

</body>
</html>
