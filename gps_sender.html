<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Location Sender</title>

<style>
body{
  background:#111;
  color:#eee;
  font-family:Arial;
  text-align:center;
  padding:20px;
}
input,button{
  padding:10px;
  font-size:16px;
  margin:6px;
}
</style>
</head>

<body>

<h2>ðŸ“¡ LOCATION SENDER</h2>

Pair Code:<br>
<input id="pair" placeholder="Enter pair code"><br>

<button onclick="sendLocation()">Send Location</button>

<p id="status">Idle</p>

<script>
const ws = new WebSocket("wss://ws-relay-zqzk.onrender.com");

// ðŸ”‘ restore saved pair code
const savedPair = localStorage.getItem("pairCode");
if (savedPair) {
  document.getElementById("pair").value = savedPair;
}

async function sendLocation(){
  const pair = document.getElementById("pair").value.trim();
  if(!pair){
    alert("Enter pair code");
    return;
  }

  // ðŸ’¾ remember pair code on this device
  localStorage.setItem("pairCode", pair);

  document.getElementById("status").innerText = "Getting network locationâ€¦";

  try{
    const res = await fetch("https://ipapi.co/json/");
    const loc = await res.json();

    if(!loc.latitude || !loc.longitude){
      document.getElementById("status").innerText = "Location unavailable";
      return;
    }

    ws.send(JSON.stringify({
      pair: pair,
      lat: loc.latitude,
      lon: loc.longitude,
      acc: 300,
      city: loc.city || "",
      region: loc.region || "",
      ts: Date.now()
    }));

    document.getElementById("status").innerText =
      "Sent | " + (loc.city || "") + " " + (loc.region || "");

  }catch(e){
    document.getElementById("status").innerText = "Network error";
  }
}
</script>

</body>
</html>
