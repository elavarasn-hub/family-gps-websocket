<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Hybrid Location Sender</title>

<style>
body{
  background:#111;
  color:#eee;
  font-family:Arial;
  text-align:center;
  padding:20px;
}
input,button{
  padding:10px;
  font-size:16px;
  margin:6px;
}
</style>
</head>

<body>

<h2>üìç LOCATION SENDER (Hybrid)</h2>

Pair Code:<br>
<input id="pair" placeholder="Enter pair code"><br>

<button onclick="start()">Start Sharing</button>

<p id="status">Idle</p>

<script>
const ws = new WebSocket("wss://ws-relay-zqzk.onrender.com");
let watchId = null;

ws.onopen = () => console.log("WS connected");

function start(){
  const pair = document.getElementById("pair").value.trim();
  if(!pair){
    alert("Enter pair code");
    return;
  }

  if(!navigator.geolocation){
    alert("Geolocation not supported");
    return;
  }

  document.getElementById("status").innerText = "Getting location‚Ä¶";

  watchId = navigator.geolocation.watchPosition(
    pos => {
      const data = {
        pair: pair,
        lat: pos.coords.latitude,
        lon: pos.coords.longitude,
        acc: Math.round(pos.coords.accuracy),
        ts: Date.now()
      };

      if(ws.readyState === WebSocket.OPEN){
        ws.send(JSON.stringify(data));
        document.getElementById("status").innerText =
          "Sent | Accuracy ‚âà " + data.acc + " m";
      }
    },
    err => {
      alert("Location error: " + err.message);
    },
    {
      enableHighAccuracy: false, // üîë HYBRID MODE
      maximumAge: 30000,         // reuse cached location (30s)
      timeout: 10000
    }
  );
}
</script>

</body>
</html>
