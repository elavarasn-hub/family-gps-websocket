<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>GPS Viewer</title>

<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
body {
  margin:0;
  background:#111;
  color:#eee;
  font-family:Arial;
  text-align:center;
}
#top {
  padding:10px;
}
#map {
  height:80vh;
}
input {
  font-size:16px;
  padding:6px;
}
</style>
</head>

<body>

<div id="top">
  <h2>ðŸ‘€ GPS Viewer</h2>
  Pair Code:
  <input id="code" value="AB1234">
  <div id="status">Waiting for data...</div>
</div>

<div id="map"></div>

<script>
const ws = new WebSocket("wss://ws-relay-zqzk.onrender.com");

const map = L.map('map').setView([20, 78], 5);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: 'Â© OpenStreetMap'
}).addTo(map);

let marker = null;

ws.onmessage = e => {
  const data = JSON.parse(e.data);
  const pair = document.getElementById("code").value.trim();

  if (data.type !== "gps") return;
  if (data.pair !== pair) return;

  document.getElementById("status").innerText =
    "Last update: " + new Date(data.ts).toLocaleTimeString();

  if (!marker) {
    marker = L.marker([data.lat, data.lon]).addTo(map);
    map.setView([data.lat, data.lon], 16);
  } else {
    marker.setLatLng([data.lat, data.lon]);
  }
};
</script>

</body>
</html>
