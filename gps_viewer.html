<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Viewer</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
body{margin:0;background:#111;color:#eee;font-family:Arial}
#top{text-align:center;padding:10px}
#map{height:85vh}
</style>
</head>

<body>

<div id="top">
<h3>üó∫Ô∏è VIEWER</h3>
Pair Code:
<input id="pair" placeholder="Enter pair code">
<p id="info">Waiting‚Ä¶</p>
</div>

<div id="map"></div>

<script>
const ws=new WebSocket("wss://ws-relay-zqzk.onrender.com");

let map=L.map("map").setView([20,78],5);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{
  maxZoom:19
}).addTo(map);

let marker=null;

ws.onmessage=e=>{
  const d=JSON.parse(e.data);
  const pair=document.getElementById("pair").value.trim();
  if(!pair || d.pair!==pair) return;

  if(!marker){
    marker=L.marker([d.lat,d.lon]).addTo(map);
  }else{
    marker.setLatLng([d.lat,d.lon]);
  }

  map.setView([d.lat,d.lon],10);
  document.getElementById("info").innerText=
    (d.city||"")+" "+(d.region||"")+" | "+
    new Date(d.ts).toLocaleTimeString();
};
</script>

</body>
</html>
